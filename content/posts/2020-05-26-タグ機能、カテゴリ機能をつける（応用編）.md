---
template: post
title: タグ機能、カテゴリ機能をつける（応用編）
slug: start-gatsby-blog-add-tags-application
draft: true
date: 2020-05-27T14:14:23.709Z
category: Programming
tags:
  - Gatsby
  - CMS
  - Tags
  - GraphQL
---
# はじめに

この記事は[Gatsby](https://www.gatsbyjs.org/)というヘッドレスCMS技術で構成されています。今回は「エンジニア初心者でもできる」を前提に以下の構成で記事を作成していこうと思います。

* [Gatsby始めるまで](https://tech-blog.yoshikiohashi.dev/posts/start-gatsby-blog/)
* [GatsbyにShare機能、OGPタグをつける](https://tech-blog.yoshikiohashi.dev/posts/start-gatsby-blog-share/)
* [タグ機能、カテゴリ機能をつける（基礎編）](https://tech-blog.yoshikiohashi.dev/posts/start-gatsby-blog-add-tags)
* [タグ機能、カテゴリ機能をつける（応用編）](https://tech-blog.yoshikiohashi.dev/posts/start-gatsby-blog-add-tags-application)（本記事）
* TableOfContents（目次）をつける（別記事予定）
* DarkModeをつける（別記事予定）

# 内容

前回はGraphQLを使用して、データを取得したJsonデータをTemplateに当てはめて画面に表示させるところまで行いました。 データの流れを理解できたでしょうか？この流れを理解するとあとは簡単です。

今回は応用編です。

「実際にはタグだけのページって必要でしょうか？」私は必要ないと思います。できれば、ユーザとしては選んだタグと記事の一覧が見れたら使いやすいはずです。

こんなタグ一覧＋記事一覧ページを作るところをゴールに目指しましょう。

![](https://ucarecdn.com/698a1a04-4692-4389-8cdc-878ab2f39ed9/)

## まずはタグ一覧＋記事一覧のテンプレートファイルの作成

`/src/templates/tags-list-template.js`

## タグ一覧を表示するコンポーネントパーツの作成

`/src/components/Tags.js`

## gatsby-node.js に `/tags/` と `/tags/{tags}` のルーティングを作成する

`gatsby-node.js`

まずはタグ一覧ページを登録します。

```
  // Tags list
  createPage({
    path: '/tags',
    component: path.resolve('./src/templates/tags-list-template.js'),
    context: { tag: "*" }
  });
```

タグが選ばれた場合のURLを登録していきます。

```
  const result = await graphql(`
    {
      allMarkdownRemark(
        filter: { frontmatter: { template: { eq: "post" }, draft: { ne: true } } }
      ) {
        group(field: frontmatter___tags) {
          fieldValue
          totalCount
        }
      }
    }
  `);

  _.each(result.data.allMarkdownRemark.group, (tag) => {
    const numPages = Math.ceil(tag.totalCount / postsPerPage);
    const tagSlug = `/tags/${_.kebabCase(tag.fieldValue)}`;

    for (let i = 0; i < numPages; i += 1) {
      createPage({
        path: i === 0 ? tagSlug : `${tagSlug}/page/${i}`,
        component: path.resolve('./src/templates/tags-list-template.js'),
        context: {
          tag: tag.fieldValue
        }
      });
    }
  }
```

## gatsby build を再度実行

`/tags` のページに遷移してみましょう。タグ一覧とその記事が表示されましたか？

# まとめ

いかがだったでしょうか？うまく設定できたでしょうか？ここまで理解できたら他の実装にも応用できますね。それでは次回の記事で。